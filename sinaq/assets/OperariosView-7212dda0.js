import{u as P,r as X,w as Y,c as w,a as ee,o as h,b as V,d as m,e as i,_ as N,f as s,g as I,h as E,i as L,s as ae,j as C,k,l as M,v as A,m as q,n as g,p as U,q as oe,t as le,x as re,y as x,z as D,A as $,B as te,F as S,C as B,D as ne,E as se,G as ie,H as ue,I as de,J as ce,K as pe,L as T,M as me,N as fe,O as ve,P as _e}from"./index-72c1ed64.js";const be={class:"grid md-grid-cols-1 md:grid-cols-1 w-full mb-6"},he={class:"grid md-grid-cols-1 md:grid-cols-2 gap-4 mb-6"},ye={class:"grid md-grid-cols-1 md:grid-cols-3 gap-4 mb-6"},ke={class:"md-grid-cols-1 md:grid-cols-5 gap-4 mb-6"},we={class:"w-full"},Z={__name:"FormOperario",props:{client:{type:Object,required:!0,default:()=>({})}},setup(o,{expose:r}){const c=P(),u=o,e=X({name:u.client?.name,email:u.client?.email,phone:u.client?.phone,id_zona:u.client?.id_zona,ud_operativa_fk:u.client?.ud_operativa_fk||1,type:u.client?.type||4,id:u.client?.id,zonas:[],color:"",olor:[],sabor:"",tipo:"",prueba:"5"}),f=n=>c.getTipoPersonal.find(a=>a.id===n),v=()=>!e.name||!e.email||!e.ud_operativa_fk||!e.type?(console.error("Faltan campos requeridos"),!1):{id:e.id||null,name:e.name,email:e.email,ud_operativa_fk:e.ud_operativa_fk,type:e.type,zonas:e.zonas,phone:e.phone};Y(()=>u.client,n=>{e.id=n?.id||null,e.name=n?.name,e.email=n?.email,e.phone=n?.phone,e.id_zona=n?.id_zona,e.type=n?.type,e.ud_operativa_fk=n?.ud_operativa_fk,O(n?.id)},{inmediate:!0});const _=w(()=>c.getUnidadesOperativas.map(n=>({value:n.id,label:n.name}))),b=n=>n?c.getZonas.filter(a=>a.unidades_operativas_fk===n).map(a=>({value:a.id,label:a.name})):(console.warn("El valor de unidad operativa es undefined o null"),[]),O=async n=>{if(!n)return console.warn("El valor de id es undefined o null"),[];const a=await ae(n);e.zonas=a.flatMap(y=>y.zonas_personal.map(p=>p.zonas_abastecimiento.id))};return O(e.id),r({submitHandler:v}),(n,a)=>{const y=ee("FormKit");return h(),V(L,null,{default:m(()=>[i(N,null,{footer:m(()=>a[6]||(a[6]=[])),default:m(()=>[s("form",{onSubmit:I(v,["prevent"])},[s("div",be,[i(y,{modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=p=>e.name=p),type:"text",label:"Nombre",placeholder:"Nombre",validation:"required",class:"w-full"},null,8,["modelValue"])]),s("div",he,[i(y,{modelValue:e.email,"onUpdate:modelValue":a[1]||(a[1]=p=>e.email=p),type:"email",label:"e-mail",placeholder:"e-mail",validation:"required",class:"w-full"},null,8,["modelValue"]),i(y,{modelValue:e.phone,"onUpdate:modelValue":a[2]||(a[2]=p=>e.phone=p),type:"number",label:"phone",placeholder:"phone",validation:"required",class:"w-full"},null,8,["modelValue"])]),s("div",ye,[i(y,{modelValue:e.ud_operativa_fk,"onUpdate:modelValue":a[3]||(a[3]=p=>e.ud_operativa_fk=p),type:"select",label:"Unidad Operativa",validation:"required",class:"w-full",options:_.value},null,8,["modelValue","options"]),i(y,{modelValue:e.type,"onUpdate:modelValue":a[4]||(a[4]=p=>e.type=p),value:f(e.type),options:E(c).getTipoPersonal.map(p=>({value:p.id,label:p.tipo})),type:"select",label:"Tipo",validation:"required",class:"w-full"},null,8,["modelValue","value","options"])]),s("div",ke,[s("div",we,[i(y,{modelValue:e.zonas,"onUpdate:modelValue":a[5]||(a[5]=p=>e.zonas=p),options:b(e.ud_operativa_fk),type:"checkbox",name:"zonas","options-class":"mb-4  flex jutify-between items-center space-x-2 p-10 rounded-md w-full","option-class":"w-full"},null,8,["modelValue","options"])])])],32)]),_:1})]),_:1})}}},ge=async o=>{try{const{data:r,error:c}=await C.from("personal").insert({name:o.name,email:o.email,phone:o.phone,ud_operativa_fk:o.ud_operativa_fk,type:o.type}).select().single();if(c)throw c;const u=o.zonas.map(v=>({personal_fk:r.id,zonas_fk:v})),{data:e,error:f}=await C.from("zonas_personal").insert(u).select();if(f)throw f;return{operario:r,zonas:e}}catch(r){throw console.error("Error en setOperarios:",r),r}},Oe=async o=>{try{const{error:r}=await C.from("zonas_personal").delete().eq("personal_fk",o);if(r)throw r;const{error:c}=await C.from("personal").delete().eq("id",o);if(c)throw c;return!0}catch(r){throw console.error("Error al eliminar operario:",r),r}},Ve=async o=>{try{const r={name:o.name,email:o.email,phone:o.phone,ud_operativa_fk:o.ud_operativa_fk,type:o.type},{data:c,errorOperario:u}=await C.from("personal").update(r).eq("id",o.id).select();if(u)throw u;const{error:e}=await C.from("zonas_personal").delete().eq("personal_fk",o.id);if(e)throw e;const f=o.zonas.map(b=>({personal_fk:o.id,zonas_fk:b})),{data:v,error:_}=await C.from("zonas_personal").insert(f).select();if(_)throw _;return{operario:c,zonas:v}}catch(r){throw console.error("Error en updateOperariobyId:",r),r}},ze={class:"space-y-3"},j={__name:"CardBoxModalOperario",props:{title:{type:String,required:!0},button:{type:String,default:"info"},buttonLabel:{type:String,default:"Done"},hasCancel:Boolean,modelValue:{type:[String,Number,Boolean],default:null},client:{type:Object,required:!1,default:()=>({id:null,name:"",email:"",phone:"",ud_operativa_fk:null,type:null,zonas:[]})}},emits:["update:modelValue","cancel","confirm"],setup(o,{emit:r}){const c=P(),u=o,e=k(null),f=w(()=>u.client?`${u.title} ${u.client.name}`:u.title),v=r,_=w({get:()=>u.modelValue,set:a=>v("update:modelValue",a)}),b=a=>{_.value=!1,v(a)},O=async()=>{try{const a=e.value?.submitHandler();if(!a)throw new Error("Datos del formulario no válidos");a.id?await Ve(a):await ge(a),c.loadOperarios(),alert("Operación realizada con éxito"),b("confirm")}catch(a){console.error("Error en operación:",a),alert(`Error: ${a.message||"Error desconocido"}`)}},n=()=>b("cancel");return window.addEventListener("keydown",a=>{a.key==="Escape"&&_.value&&n()}),(a,y)=>M((h(),V(re,{onOverlayClick:n},{default:m(()=>[M(i(N,{class:"shadow-lg max-h-modal w-11/12 md:w-3/5 lg:w-4/5 xl:w-7/12 z-50","is-modal":""},{footer:m(()=>[i(q,null,{default:m(()=>[i(g,{label:o.buttonLabel,color:o.button,onClick:O},null,8,["label","color"]),o.hasCancel?(h(),V(g,{key:0,label:"Cancel",color:o.button,outline:"",onClick:n},null,8,["color"])):U("",!0)]),_:1})]),default:m(()=>[i(oe,{title:f.value},{default:m(()=>[o.hasCancel?(h(),V(g,{key:0,icon:E(le),color:"whiteDark",small:"","rounded-full":"",onClick:I(n,["prevent"])},null,8,["icon"])):U("",!0)]),_:1},8,["title"]),s("div",ze,[i(Z,{ref_key:"formRef",ref:e,client:o.client},null,8,["client"])])]),_:1},512),[[A,_.value]])]),_:1},512)),[[A,_.value]])}},$e={key:0},Ce={class:"border-b-0 lg:w-6 before:hidden"},Ee={"data-label":"Name"},xe={"data-label":"Tipo"},Ue={"data-label":"email"},De={"data-label":"Unidad Operativa"},Se={class:"before:hidden lg:w-1 whitespace-nowrap"},qe={class:"p-3 lg:px-6 border-t border-gray-100 dark:border-slate-800"},Te={__name:"TablaOperarios",props:{checkable:Boolean},setup(o){const r=P(),c=k(!1),u=k(null),e=k(null),f=w(()=>r.getOperarios),v=k(!1),_=k(10),b=k(0),O=k([]),n=w(()=>f.value.slice(_.value*b.value,_.value*(b.value+1))),a=w(()=>Math.ceil(f.value.length/_.value)),y=w(()=>b.value+1),p=w(()=>{const d=[];for(let l=0;l<a.value;l++)d.push(l);return d}),F=d=>r.getTipoPersonal.find(t=>t.id===d)?.tipo??"N/A",H=d=>{e.value=d,v.value=!0},K=async()=>{try{const d=e.value.id;await Oe(d),await r.loadOperarios(),v.value=!1,e.value=null,alert("Operario eliminado correctamente")}catch(d){alert("Error al borrar operario"),console.log("error al borrar operario: ",d)}},R=d=>{switch(d){case 4:return fe;case 1:return me;case 2:return T;case 3:return pe;default:return ce}},G=d=>{u.value=d,c.value=!0},J=(d,l)=>{const t=[];return d.forEach(z=>{l(z)||t.push(z)}),t},W=(d,l)=>{d?O.value.push(l):O.value=J(O.value,t=>t.id===l.id)},Q=d=>w(()=>r.getUnidadesOperativas.find(t=>t.id===d)?.name??"N/A");return(d,l)=>(h(),x(S,null,[u.value!==null?(h(),V(j,{key:0,modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=t=>c.value=t),client:u.value,title:"Editar Operario","has-cancel":""},null,8,["modelValue","client"])):U("",!0),i(te,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=t=>v.value=t),title:"Eliminar Operario",button:"danger","has-cancel":"",onConfirm:K},{default:m(()=>[s("p",null,[l[2]||(l[2]=D(" Esta seguro que desea eliminar el operario ")),s("b",null,$(e.value?.name),1),l[3]||(l[3]=D("? "))]),l[4]||(l[4]=s("p",null,"Esta operación no se puede deshacer.",-1))]),_:1},8,["modelValue"]),s("table",null,[s("thead",null,[s("tr",null,[o.checkable?(h(),x("th",$e)):U("",!0),l[5]||(l[5]=s("th",null,null,-1)),l[6]||(l[6]=s("th",null,"Nombre",-1)),l[7]||(l[7]=s("th",null,"Tipo",-1)),l[8]||(l[8]=s("th",null,"e-mail",-1)),l[9]||(l[9]=s("th",null,"UO",-1)),l[10]||(l[10]=s("th",null,null,-1))])]),s("tbody",null,[(h(!0),x(S,null,B(n.value,t=>(h(),x("tr",{key:t.id},[o.checkable?(h(),V(ne,{key:0,onChecked:z=>W(z,t)},null,8,["onChecked"])):U("",!0),s("td",Ce,[i(se,{username:t.name,class:"w-24 h-24 mx-auto lg:w-6 lg:h-6"},null,8,["username"])]),s("td",Ee,$(t.name),1),s("td",xe,[i(g,{color:"info",icon:R(t.type),small:"",class:"mr-2"},null,8,["icon"]),D(" "+$(F(t.type)),1)]),s("td",Ue,$(t.email),1),s("td",De,$(Q(t.ud_operativa_fk)),1),s("td",Se,[i(q,{type:"justify-start lg:justify-end","no-wrap":""},{default:m(()=>[i(g,{color:"info",icon:E(ie),small:"",onClick:z=>G(t)},null,8,["icon","onClick"]),i(g,{color:"danger",icon:E(ue),small:"",onClick:z=>H(t)},null,8,["icon","onClick"]),i(g)]),_:2},1024)])]))),128))])]),s("div",qe,[i(de,null,{default:m(()=>[i(q,null,{default:m(()=>[(h(!0),x(S,null,B(p.value,t=>(h(),V(g,{key:t,active:t===b.value,label:t+1,color:t===b.value?"lightDark":"whiteDark",small:"",onClick:z=>b.value=t},null,8,["active","label","color","onClick"]))),128))]),_:1}),s("small",null,"Page "+$(y.value)+" of "+$(a.value),1)]),_:1})])],64))}},Ne={__name:"OperariosView",setup(o){const r=k(!1),c=()=>{r.value=!0};return(u,e)=>(h(),V(ve,null,{default:m(()=>[i(L,null,{default:m(()=>[i(_e,{icon:E(T),title:"Operarios",main:""},{default:m(()=>[i(g,{target:"_blank",icon:E(T),label:"Nuevo Operario",outline:"",color:"info","rounded-full":"",small:"",onClick:c},null,8,["icon"])]),_:1},8,["icon"]),i(j,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=f=>r.value=f),title:"Editar Operario","has-cancel":""},{default:m(()=>[i(Z,{onCancelModal:e[0]||(e[0]=f=>r.value=!1)})]),_:1},8,["modelValue"]),i(N,{class:"mb-6","has-table":""},{default:m(()=>[i(Te,{checkable:""})]),_:1})]),_:1})]),_:1}))}};export{Ne as default};
