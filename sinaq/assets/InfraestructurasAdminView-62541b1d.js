import{j as T,u as Z,r as H,c as M,w as q,o as p,b as S,d as f,e as u,_ as B,m as F,n as k,f as e,g as j,h as m,Q as h,y as g,p as E,i as O,k as I,z,A as x,B as G,F as $,C as P,R as L,S as R,T as K,U as D,X as Q,G as W,H as X,O as Y,P as J,Y as ee,W as ae}from"./index-72c1ed64.js";import{_ as le}from"./CardBoxModalForm-4ae1fe9d.js";const oe=async c=>{try{const{data:t}=await T.from("infraestructuras").insert({id:c.id,name:c.name,type:c.tipo_infraestructura_fk,operador:c.operador}).select().single();return t}catch(t){throw console.error("Error en setZona:",t),t}},te=async c=>{try{const{data:t}=await T.from("infraestructuras").update({activo:!1}).eq("id",c).single();return t}catch(t){throw console.error("Error en anularInfraestructura:",t),t}},se=async c=>{console.log(c);try{const{data:t}=await T.from("infraestructuras").update({name:c.name,type:c.type,operador:c.operador}).eq("id",c.id).single();return t}catch(t){throw console.error("Error al Actualizar la Infraestructura:",t),alert("Error al Actualizar la Infraestructura:",t),t}},ne={class:"grid grid-cols-1 lg:grid-cols-6 mb-6 gap-4 w-full"},re={class:"col-span-1 w-full"},ue={class:"col-span-5 w-full"},de={class:"flex flex-col w-full md:flex-row md:space-x-4 md:space-y-0 space-y-4 mb-6"},ie={key:0,class:"grid md-grid-cols-1 md:grid-cols-1 gap-4 mb-6"},ce={__name:"FormInfraestructura",props:{uo:{type:Object,required:!0,default:()=>({esNuevo:!0})}},emits:["submit","closeModal"],setup(c,{expose:t,emit:_}){const y=_,v=Z(),d=c,a=H({esNuevo:d.uo?.esNuevo??!0,id:d.uo?.id||null,name:d.uo?.name,type:d.uo?.type,operador:d.uo?.operador,zonas:[]}),b=()=>{if(console.log("submitHandler"),!a.name||!a.com_autonoma_fk||!a.unidades_operativas_fk)return console.error("Faltan campos requeridos"),!1;const s={id:a.id,name:a.name,type:a.type,operador:a.operador};y("submit",s)},C=M(()=>v.getTipoInfraestructura.map(s=>({value:s.id,label:s.name}))),V=s=>v.getZonas.filter(r=>r.com_autonoma_fk===s).map(r=>({value:r.id,label:r.name})),N=M(()=>{const s=v.getZonas.map(n=>({value:n.id,label:n.name}));return console.log("ZONAS: ",s),s});return q(()=>d.uo,s=>{a.esNuevo=s?.esNuevo,a.id=s?.id,a.name=s?.name,a.type=s?.type,a.operador=s?.operador},{inmediate:!0}),(async s=>{if(!s)return console.warn("El valor de id es undefined o null"),[];const n=v.getZonas.filter(r=>r.unidades_operativas_fk===s).map(r=>r.id);a.zonas=n})(a.id),t({submitHandler:b}),(s,n)=>(p(),S(O,null,{default:f(()=>[u(B,{"is-form":""},{footer:f(()=>[u(F,null,{default:f(()=>[u(k,{type:"submit",color:"info",label:"Guardar",onClick:n[5]||(n[5]=r=>y("submit",a))}),u(k,{type:"reset",color:"danger",outline:"",label:"Cancelar",onClick:n[6]||(n[6]=r=>y("closeModal"))})]),_:1})]),default:f(()=>[e("form",{class:"w-full",onSubmit:j(b,["prevent"])},[e("div",ne,[e("div",re,[u(m(h),{modelValue:a.id,"onUpdate:modelValue":n[0]||(n[0]=r=>a.id=r),type:"text",label:"Código",placeholder:"Nº SINAC",validation:"required",class:"col-span-1 w-full",disabled:!a.esNuevo},null,8,["modelValue","disabled"])]),e("div",ue,[u(m(h),{modelValue:a.name,"onUpdate:modelValue":n[1]||(n[1]=r=>a.name=r),type:"text",label:"Nombre",placeholder:"Nombre",validation:"required",class:"col-span-3 w-full"},null,8,["modelValue"])])]),e("div",de,[u(m(h),{modelValue:a.type,"onUpdate:modelValue":n[2]||(n[2]=r=>a.type=r),options:C.value,type:"select",label:"Tipo de Infraestructura",placeholder:"Tipo de Infraestructura",class:"w-full","option-class":"w-full"},null,8,["modelValue","options"]),u(m(h),{modelValue:a.operador,"onUpdate:modelValue":n[3]||(n[3]=r=>a.operador=r),type:"text",label:"Operador",placeholder:"Operador",validation:"required",class:"col-span-3 w-full"},null,8,["modelValue"])]),a.comunidadAutonoma?(p(),g("div",ie,[u(m(h),{modelValue:a.zonas,"onUpdate:modelValue":n[4]||(n[4]=r=>a.zonas=r),options:a.comunidadAutonoma?V(a.comunidadAutonoma):N.value,label:"Zonas",type:"checkbox",name:"zonas","options-class":"w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-2 space-y-2 p-4 rounded-md","option-class":"flex items-center"},null,8,["modelValue","options"])])):E("",!0)],32)]),_:1})]),_:1}))}},me={"data-label":"ID"},pe={"data-label":"Name"},fe={"data-label":"Tipo"},ve={"data-label":"Operador"},_e={colspan:"3"},be={class:"px-4"},ge={key:0,class:"flex items-center text-gray-500 py-2"},ye={key:1,class:"space-y-2"},xe={class:"text-sm"},Ie={class:"w-1"},ke={class:"flex flex-col items-center space-y-2"},we={__name:"InfraestructurasTable",props:{checkable:{type:Boolean,default:!1}},setup(c,{expose:t}){const _=Z(),y=M(()=>_.getInfraestructuras.filter(o=>o.activo)),v=I(!1),d=I(null),a=I(!1),b=I([]),C=o=>_.getTipoInfraestructura.find(i=>i.id===o)?.name??"-",V=o=>_.getPuntosMuestreo.filter(l=>l.infraestructura_fk===o).map(l=>({name:l.name,id:l.id})),N=o=>{b.value.includes(o)?b.value=b.value.filter(l=>l!==o):b.value.push(o)},A=o=>{d.value=o,console.log("openModal:",d.value),a.value=!0},s=()=>{a.value=!1,d.value=null},n=o=>{d.value=o,v.value=!0},r=async()=>{try{const o=d.value.id;await te(o),await _.loadInfraestructuras(),v.value=!1,d.value=null,alert("Infraestructura eliminada correctamente")}catch(o){console.log("error al borrar la Infraestructura: ",o),alert("error al borrar la Infraestructura: ")}},U=async o=>{o.esNuevo?(console.log("Formulario Nuevo:",o.id),await oe(o)):(console.log("Formulario Editado:",o),await se(o)),await _.loadInfraestructuras(),s(),alert("Infraestructura guardada correctamente")};return q(y,o=>{console.log("Zonas de Abastecimiento:",o)}),t({openModal:A}),(o,l)=>(p(),g($,null,[d.value!==null?(p(),S(le,{key:0,modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=i=>a.value=i),uo:d.value,title:d.value?.id?`Editar Infraestructura ${d.value?.name}`:"Crear Nueva Infraestructura","has-cancel":""},{default:f(()=>[u(ce,{uo:d.value,onSubmit:U,onCloseModal:s},null,8,["uo"])]),_:1},8,["modelValue","uo","title"])):E("",!0),u(G,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=i=>v.value=i),title:"Eliminar Infraestructura",button:"danger","has-cancel":"",onConfirm:r},{default:f(()=>[e("p",null,[l[2]||(l[2]=z(" Esta seguro que desea eliminar la Infraestructura ")),e("b",null,x(d.value?.name),1),l[3]||(l[3]=z("? "))]),l[4]||(l[4]=e("p",null,"Esta operación no se puede deshacer.",-1))]),_:1},8,["modelValue"]),e("div",null,[e("table",null,[l[9]||(l[9]=e("thead",null,[e("tr",null,[e("th"),e("th",null,"ID"),e("th",null,"Nombre"),e("th",null,"Tipo"),e("th",null,"Operador"),e("th")])],-1)),e("tbody",null,[(p(!0),g($,null,P(y.value,i=>(p(),g($,{key:i.id},[e("tr",null,[l[5]||(l[5]=e("td",{class:"border-b-0 lg:w-6 before:hidden"},null,-1)),e("td",me,x(i.id),1),e("td",pe,x(i.name),1),e("td",fe,x(C(i.type)),1),e("td",ve,x(i.operador),1),e("td",null,[u(k,{icon:b.value.includes(i.id)?m(L):m(R),color:"info",onClick:w=>N(i.id)},null,8,["icon","onClick"])])]),b.value.includes(i.id)?(p(),g("tr",{key:`expanded-${i.id}`},[l[8]||(l[8]=e("td",null,null,-1)),e("td",_e,[l[7]||(l[7]=e("p",{class:"font-bold"},"Puntos de Muestreo",-1)),e("div",be,[V(i.id).length===0?(p(),g("div",ge,[u(D,{path:m(K),class:"w-5 h-5 mr-2"},null,8,["path"]),l[6]||(l[6]=e("span",{class:"text-sm italic"},"No hay puntos de muestreo asignados",-1))])):(p(),g("ul",ye,[(p(!0),g($,null,P(V(i.id),w=>(p(),g("li",{key:w.id,class:"flex items-center text-gray-700 hover:text-blue-600 transition-colors duration-200"},[u(D,{path:m(Q),class:"w-5 h-5 mr-2 text-blue-500"},null,8,["path"]),e("span",xe,x(w.name),1)]))),128))]))])]),e("td",Ie,[e("div",ke,[u(F,{class:"pl-8"},{default:f(()=>[u(k,{icon:m(W),color:"info",onClick:w=>A({...i,esNuevo:!1})},null,8,["icon","onClick"]),u(k,{icon:m(X),color:"danger",onClick:w=>n(i)},null,8,["icon","onClick"])]),_:2},1024)])])])):E("",!0)],64))),128))])])])],64))}},he={class:"flex gap-2"},Ce={__name:"InfraestructurasAdminView",setup(c){I(!1);const t=I(null),_=()=>{t.value.openModal()};return(y,v)=>(p(),S(Y,null,{default:f(()=>[u(O,null,{default:f(()=>[u(J,{icon:m(ee),title:"Infraestructuras",main:""},{default:f(()=>[e("div",he,[u(k,{target:"_blank",icon:m(ae),label:"Nueva Zona",color:"info",outline:"","rounded-full":"",small:"",onClick:_},null,8,["icon"])])]),_:1},8,["icon"]),u(B,{class:"mb-6","has-table":""},{default:f(()=>[u(we,{ref_key:"table",ref:t},null,512)]),_:1})]),_:1})]),_:1}))}};export{Ce as default};
