import{u as Z,k as v,r as D,c as N,Z as L,w as A,o as y,b as I,d,e as s,_ as F,m as T,n as M,f as t,g as j,h as f,Q as P,A as g,i as q,j as S,$ as U,y as $,p as G,z as E,B as H,F as K,C as O,G as W,H as Q,O as Y,P as J,a0 as R,W as X}from"./index-72c1ed64.js";import{_ as ee}from"./CardBoxModalForm-4ae1fe9d.js";import{L as B,i as oe,v as te,u as ae,g as le,b as se,y as ne}from"./maps-5273b09b.js";const re={class:"grid grid-cols-1 lg:grid-cols-6 mb-6 gap-4 w-full"},ue={class:"col-span-1 w-full"},ie={class:"col-span-5 w-full"},ce={class:"flex flex-col w-full md:flex-row md:space-x-4 md:space-y-0 space-y-4 mb-6"},de={style:{height:"300px",width:"100%"}},fe={class:"text-center"},me={class:"text-lg font-bold"},pe={class:"text-sm"},_e={class:"text-center"},ve={class:"text-lg font-bold"},ge=["href"],be={class:"text-sm"},ke={class:"items-center justify-center flex w-full"},ye={__name:"FormPuntoMuestreo",props:{uo:{type:Object,required:!0,default:()=>({esNuevo:!0})}},emits:["submit","closeModal"],setup(r,{expose:m,emit:u}){const k=u,b=Z(),h="d6ae26b3d87042278ec375bbfc9d89ac",c=v(13),p=v(!1),_=r,e=D({esNuevo:_.uo?.esNuevo??!0,id:_.uo?.id||null,name:_.uo?.name,infraestructura_fk:_.uo?.infraestructura_fk,zona_fk:_.uo?.zona_fk,posicion:_.uo?.posicion}),w=()=>{if(console.log("submitHandler"),!e.name||!e.infraestructura_fk||!e.zona_fk)return console.error("Faltan campos requeridos"),!1;const o={id:e.id,name:e.name,infraestructura_fk:e.infraestructura_fk,zona_fk:e.zona_fk,posicion:e.posicion,esNuevo:e.esNuevo};k("submit",o)},x=N(()=>b.getInfraestructuras.map(o=>({value:o.id,label:o.name}))),z=N(()=>b.getZonas.map(o=>({value:o.id,label:o.name}))),V=()=>{p.value=!p.value};N(()=>{const o=b.getZonas.map(l=>({value:l.id,label:l.name}));return console.log("ZONAS: ",o),o}),B.divIcon({html:`
  <div class="marker-pin">
    <svg viewBox="0 0 24 24" style="width: 60px; height: 60px;">
      <path fill="#2196f3" d="${L}" />
    </svg>
    </div>
    `,className:"custom-div-icon",iconSize:[24,24],iconAnchor:[12,24]}),A(()=>_.uo,o=>{e.esNuevo=o?.esNuevo,e.id=o?.id,e.name=o?.name,e.infraestructura_fk=o?.infraestructura_fk,e.zona_fk=o?.zona_fk,e.posicion=o?.posicion,p.value=!1},{inmediate:!0});const C=async o=>{if(!o)return console.warn("El valor de id es undefined o null"),[];const l=b.getZonas.filter(i=>i.unidades_operativas_fk===o).map(i=>i.id);e.zonas=l},a=o=>B.icon({iconUrl:`https://api.geoapify.com/v1/icon/?type=material&color=blue&icon=${o}&iconType=awesome&apiKey=${h}`,iconSize:[31,46],iconAnchor:[15.5,42],popupAnchor:[0,-45]}),n=(o,l)=>`https://www.google.com/maps?q=${o},${l}`;return C(e.id),m({submitHandler:w}),(o,l)=>(y(),I(q,null,{default:d(()=>[s(F,{"is-form":""},{footer:d(()=>[s(T,null,{default:d(()=>[s(M,{type:"submit",color:"info",label:"Guardar",onClick:l[6]||(l[6]=i=>k("submit",e))}),s(M,{type:"reset",color:"danger",outline:"",label:"Cancelar",onClick:l[7]||(l[7]=i=>k("closeModal"))})]),_:1})]),default:d(()=>[t("form",{class:"w-full",onSubmit:j(w,["prevent"])},[t("div",re,[t("div",ue,[s(f(P),{modelValue:e.id,"onUpdate:modelValue":l[0]||(l[0]=i=>e.id=i),type:"text",label:"Código",placeholder:"Nº SINAC",validation:"required",class:"col-span-1 w-full",disabled:!e.esNuevo},null,8,["modelValue","disabled"])]),t("div",ie,[s(f(P),{modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=i=>e.name=i),type:"text",label:"Nombre",placeholder:"Nombre",validation:"required",class:"col-span-3 w-full"},null,8,["modelValue"])])]),t("div",ce,[s(f(P),{modelValue:e.infraestructura_fk,"onUpdate:modelValue":l[2]||(l[2]=i=>e.infraestructura_fk=i),options:x.value,type:"select",label:"Infraestructura",placeholder:"Infraestructura",class:"w-full","option-class":"w-full"},null,8,["modelValue","options"]),s(f(P),{modelValue:e.zona_fk,"onUpdate:modelValue":l[3]||(l[3]=i=>e.zona_fk=i),options:z.value,type:"select",label:"Zona",placeholder:"Zona",class:"w-full","option-class":"w-full"},null,8,["modelValue","options"])]),t("div",de,[s(f(oe),{ref:"map",zoom:c.value,"onUpdate:zoom":l[5]||(l[5]=i=>c.value=i),center:e.posicion?[e.posicion.lat,e.posicion.lon]:[39.54982998070428,-.4656852311920545],"use-global-leaflet":!1},{default:d(()=>[s(f(te),{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","layer-type":"base",name:"OpenStreetMap"}),s(f(ae),{"lat-lng":e.posicion?[e.posicion.lat,e.posicion.lon]:[39.54982998070428,-.4656852311920545],draggable:p.value,icon:a(f(le)(e.infraestructura_fk)),onDragend:l[4]||(l[4]=i=>{e.posicion={lat:i.target.getLatLng().lat,lon:i.target.getLatLng().lng},console.log("New position:",e.posicion)})},{default:d(()=>[s(f(se),null,{default:d(()=>[t("div",fe,[t("h1",me,g(e.name),1),t("p",pe,g(e.id),1)])]),_:1}),s(f(ne),null,{default:d(()=>[t("div",_e,[t("h1",ve,g(e.name),1),t("a",{href:n(e.posicion?.lat||33.84984041752422,e.posicion?.lon||-111.42066937394506),target:"_blank",class:"text-sm"},"Ver en Google Maps",8,ge),t("p",be,g(e.id),1)])]),_:1})]),_:1},8,["lat-lng","draggable","icon"])]),_:1},8,["zoom","center"])]),t("div",ke,[s(M,{label:p.value?"Fijar Posición":"Editar Posición",color:"info",class:"w-full",onClick:V},null,8,["label"])])],32)]),_:1})]),_:1}))}},he=async r=>{const{data:m,error:u}=await S.from("puntos_muestreo").insert({id:r.id,name:r.name,infraestructura_fk:r.infraestructura_fk,zona_fk:r.zona_fk,posicion:r.posicion,activo:r.activo}).select().single();if(u)throw u;return m},Me=async r=>{const{data:m,error:u}=await S.from("puntos_muestreo").update({activo:!1}).eq("id",r).select().single();if(u)throw u;return m},we=async r=>{const{data:m,error:u}=await S.from("puntos_muestreo").update({name:r.name,infraestructura_fk:r.infraestructura_fk,zona_fk:r.zona_fk,posicion:r.posicion,activo:r.activo}).eq("id",r.id).select().single();if(u)throw u;return m},xe={key:0,class:"flex justify-center items-center p-4"},Pe={key:1},$e={"data-label":"ID"},Ne={"data-label":"Name"},ze={"data-label":"Tipo"},Ve={"data-label":"Operador"},Ce={class:"flex flex-col items-center space-y-2"},Ie={__name:"PuntosMuestreoTable",props:{checkable:{type:Boolean,default:!1}},setup(r,{expose:m}){const u=Z(),k=N(()=>u.getPuntosMuestreo.filter(a=>a.activo)),b=v(!0),h=v(!1),c=v(null),p=v(!1);v([]);const _=a=>u.getInfraestructuras.find(n=>n.id===a)?.name??"-",e=a=>u.getZonas.find(n=>n.id===a)?.name??"-",w=a=>{c.value=a,console.log("openModal:",c.value),p.value=!0},x=()=>{p.value=!1,c.value=null},z=a=>{c.value=a,h.value=!0},V=async()=>{try{const a=c.value.id;await Me(a),await u.loadPuntosMuestreo(),h.value=!1,c.value=null,alert("Punto de Muestreo eliminado correctamente")}catch(a){console.log("error al borrar el Punto de Muestreo: ",a),alert("error al borrar el Punto de Muestreo: ",a)}},C=async a=>{a.esNuevo?(console.log("Formulario Nuevo:",a.id),await he(a)):(console.log("Formulario Editado:",a),await we(a)),await u.loadPuntosMuestreo(),x(),alert("Punto de Muestreo guardado correctamente")};return U(async()=>{try{await u.loadPuntosMuestreo(),b.value=!1}catch(a){console.error("Error al cargar puntos de muestreo:",a)}}),A(k,a=>{console.log("Puntos de Muestreo WATCH:",a)}),m({openModal:w}),(a,n)=>b.value?(y(),$("div",xe,n[2]||(n[2]=[t("span",{class:"text-gray-500"},"Cargando datos...",-1)]))):(y(),$("div",Pe,[c.value!==null?(y(),I(ee,{key:0,modelValue:p.value,"onUpdate:modelValue":n[0]||(n[0]=o=>p.value=o),uo:c.value,title:c.value?.id?`Editar Punto Muestreo ${c.value?.name}`:"Crear Punto Muestreo","has-cancel":""},{default:d(()=>[s(ye,{uo:c.value,onSubmit:C,onCloseModal:x},null,8,["uo"])]),_:1},8,["modelValue","uo","title"])):G("",!0),s(H,{modelValue:h.value,"onUpdate:modelValue":n[1]||(n[1]=o=>h.value=o),title:"Eliminar Infraestructura",button:"danger","has-cancel":"",onConfirm:V},{default:d(()=>[t("p",null,[n[3]||(n[3]=E(" Esta seguro que desea eliminar la Infraestructura ")),t("b",null,g(c.value?.name),1),n[4]||(n[4]=E("? "))]),n[5]||(n[5]=t("p",null,"Esta operación no se puede deshacer.",-1))]),_:1},8,["modelValue"]),t("div",null,[t("table",null,[n[7]||(n[7]=t("thead",null,[t("tr",null,[t("th"),t("th",null,"ID"),t("th",null,"Nombre"),t("th",null,"Infraestructura"),t("th",null,"Zona"),t("th")])],-1)),t("tbody",null,[(y(!0),$(K,null,O(k.value,o=>(y(),$("tr",{key:o.id},[n[6]||(n[6]=t("td",{class:"border-b-0 lg:w-6 before:hidden"},null,-1)),t("td",$e,g(o.id),1),t("td",Ne,g(o.name),1),t("td",ze,g(_(o.infraestructura_fk)),1),t("td",Ve,g(e(o.zona_fk)),1),t("td",null,[t("div",Ce,[s(T,{class:"pl-8"},{default:d(()=>[s(M,{icon:f(W),color:"info",onClick:l=>w({...o,esNuevo:!1})},null,8,["icon","onClick"]),s(M,{icon:f(Q),color:"danger",onClick:l=>z(o)},null,8,["icon","onClick"])]),_:2},1024)])])]))),128))])])])]))}},Se={class:"flex gap-2"},Ae={__name:"PuntosMuestreoAdminView",setup(r){v(!1);const m=v(null),u=()=>{m.value.openModal()};return(k,b)=>(y(),I(Y,null,{default:d(()=>[s(q,null,{default:d(()=>[s(J,{icon:f(R),title:"Puntos de Muestreo",main:""},{default:d(()=>[t("div",Se,[s(M,{target:"_blank",icon:f(X),label:"Nuevo Punto de Muestreo",color:"info",outline:"","rounded-full":"",small:"",onClick:u},null,8,["icon"])])]),_:1},8,["icon"]),s(F,{class:"mb-6","has-table":""},{default:d(()=>[s(Ie,{ref_key:"table",ref:m},null,512)]),_:1})]),_:1})]),_:1}))}};export{Ae as default};
