import{a5 as b,u as O,c as o,r as _,w as k}from"./index-72c1ed64.js";function P(){const s=b(),t=O(),i=e=>{if(!t?.getOperarios)return"HOLA";const a=t.getOperarios.find(r=>r.email===e);return a?a.id:null},u=o(()=>!s?.userEmail||!t?.getOperarios?(console.warn("No hay email de usuario o no hay operarios"),null):t.getOperarios.find(a=>a?.email?a.email.toLowerCase()===s.userEmail.toLowerCase():!1)||null),l=new Date().toISOString().split("T")[0],n=_({uo:"",zona:null,punto_muestreo_fk:null,fecha:l,color:1,olor:1,sabor:1,cloro:"",type:"",observaciones:"",ph:null,turbidez:null,operario:"",infraestructura:null,fecha_inicio:null,fecha_final:null});k(()=>t.getOperarios,()=>{u.value},{immediate:!0});const c=()=>{Object.keys(n).forEach(e=>{n[e]=null})},f=o(()=>t.getUnidadesOperativas.map(e=>({value:e.id,label:e.name}))),m=o(()=>n.uo?t.getZonas.filter(e=>e.unidades_operativas_fk===n.uo).map(e=>({value:e.id,label:e.name})):t.getZonas.map(e=>({value:e.id,label:e.name}))),d=o(()=>n.zona?t.getZonasInfraestructuras.filter(a=>a.zonas_fk===n.zona).map(a=>({value:a.infraestructuras_fk,label:p(a.infraestructuras_fk)})):t.getPuntosMuestreo.map(a=>({value:a.id,label:a.name}))),p=e=>{const a=t.getInfraestructuras.find(r=>r.id===e);return a?a.name:""},g=o(()=>{if(s.userRole===99)return n.infraestructura?t.getPuntosMuestreo.filter(r=>r.infraestructura_fk===n.infraestructura).map(r=>({value:r.id,label:r.name})):t.getPuntosMuestreo.map(r=>({value:r.id,label:r.name}));const e=t.getOperarios.find(r=>r.email?.toLowerCase()===s.userEmail?.toLowerCase());if(!e||!e.zonas)return console.warn("Operario no encontrado o sin zonas asignadas"),[];const a=e.zonas.map(r=>typeof r=="object"?r.id:r);return console.log("Zonas asignadas al operario:",a),n.infraestructura?t.getPuntosMuestreo.filter(r=>r.activo&&r.infraestructura_fk===n.infraestructura&&a.includes(r.zona_fk)).map(r=>({value:r.id,label:r.name})):t.getPuntosMuestreo.filter(r=>r.activo&&a.includes(r.zona_fk)).map(r=>({value:r.id,label:r.name}))}),v=o(()=>n.uo?t.getOperarios.filter(e=>e.ud_operativa_fk===n.uo).map(e=>({value:e.id,label:e.name})):t.getOperarios.map(e=>({value:e.id,label:e.name})));return{resetForm:c,form:n,selectUO:f,selectZona:m,selectInfraestructura:d,selectPuntosMuestra:g,operarioPorZona:v,findOperarioByUser:i,operarioLogueado:u}}export{P as u};
